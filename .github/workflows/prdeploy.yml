name: Package Bundle and PR Automation

on:
  # You can customize the trigger as needed
  workflow_dispatch:  # Allows manual triggering
  schedule:
    - cron: '0 0 * * 1'  # Weekly on Mondays at midnight

jobs:
  package-and-merge:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm install
      
      - name: Run package bundle command
        run: npm run bundle
        # Assuming this command generates changes that need to be committed
      
      - name: Create Pull Request
        id: create-pr
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: update package bundle"
          title: "Update package bundle"
          body: |
            This PR was automatically generated by the Package Bundle workflow.
            
            It contains the latest bundled package updates.
          branch: update-package-bundle
          base: main
      
      - name: Enable Pull Request Automerge
        if: steps.create-pr.outputs.pull-request-number
        run: |
          gh pr merge --merge --auto --delete-branch ${{ steps.create-pr.outputs.pull-request-number }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      # Optional: you might need a higher-privileged token for some operations
      # In that case, create a PAT (Personal Access Token) and use it instead:
      # GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
